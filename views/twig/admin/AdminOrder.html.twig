<link href="{{ asset('css/style.css') }}" rel="stylesheet">
<link href="{{ asset('js/bs-table/bootstrap-table.min.css') }}" rel="stylesheet">
<script src="{{ asset('js/bs-table/bootstrap-table.min.js') }}"></script>
<script src="{{ asset('js/bs-table/locale/bootstrap-table-it-IT.min.js') }}"></script>
<script src="{{ asset('js/adminOrders/BsTableNotes.js') }}"></script>

<div class="mt-2 mb-2">
    <mpnote-dialog id="mpnote-dialog" id-order="{{ orderId }}" endpoint="{{ mpNotes.adminControllerUrl }}"></mpnote-dialog>
    <div class="card">
        <div class="card-body">
            <div class="form-group">
            <span class="title">Messaggi: </span>
            {% for nav in navTabs %}    
                <button type="button" class="btn btn-default btn-toggle-notes" data-type="{{ nav.type }}" data-id="{{ nav.id }}">
                    <span class="material-icons" style="color: {{ nav.color }};">{{ nav.icon }}</span>
                    <span class="mr-1">{{ nav.label }}</span>
                    <span class="badge badge-info pull-end" style="font-size: 1rem;">{{ nav.notes }}</span>
                </button>
            {% endfor %}
            </div>
            <div id="table-notes-container" style="display: none;">
                <table id="bsTblNotes"></table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    let tableNotesEl = null;
    let currentActiveTblButton = null;

    document.addEventListener("DOMContentLoaded", (e) => {
        tableNotesEl = new BsTableNotes("bsTblNotes", "{{ endpoint | raw }}", "{{ orderId }}", "{{ customer.id }}");
        const btnToggleNotes = document.querySelectorAll(".btn-toggle-notes");
        
        btnToggleNotes.forEach(btn => {
            btn.addEventListener("click", (e) => {
                console.log("Click on" + btn.classList);

                const type = btn.getAttribute("data-type");
                const id = btn.getAttribute("data-id");

                const tableContainer = document.getElementById("table-notes-container");
                if(!tableContainer) {
                    showErrorMessage("Container tabella non trovato");
                    return;
                }

                if (currentActiveTblButton != btn) {
                    currentActiveTblButton = btn;
                    tableNotesEl.setType(type);
                    tableNotesEl.setId(id);
                    tableNotesEl.refreshTable();
                    $(tableContainer).show();
                } else {
                    $(tableContainer).hide();
                }
            });
        });
    });
</script>

